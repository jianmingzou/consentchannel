package com.example.consentchannel.controller;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.util.FileCopyUtils;

@RunWith(SpringRunner.class)
@WebMvcTest(ConsentChannelController.class)
class ConsentChannelControllerTest {

    @Autowired
    private MockMvc mockMvc;


  @Test
  void extractQueryString() throws Exception {
//    String query = "client_id%253DSwCIxkpf8em1ZbS5CM7MRSh9PnheUNNd%2526scope%253Dopenid+accounts%2526redirect_uri%253Dhttp%253A%252F%252Flocalhost%253A8585%252FredirectMe%2526response_type%253Dcode+id_token%2526someOtherParam%253Dblahblah%2526request%253DeyJraWQiOiJzYW1wbGVUcHBLaWQiLCJhbGciOiJSUzI1NiJ9.eyJyZXNwb25zZV90eXBlIjoiY29kZSBpZF90b2tlbiIsImNsaWVudF9pZCI6IlN3Q0l4a3BmOGVtMVpiUzVDTTdNUlNoOVBuaGVVTk5kIiwiYXVkIjoiaHR0cHM6Ly9haWItcHJvZC1wcm9kLmFwaWdlZS5uZXQiLCJzY29wZSI6Im9wZW5pZCBhY2NvdW50cyIsInN0YXRlIjoiOWU3MjY3NDgtYzExOS00NmRkLTg0ZGMtMjQxY2MzOWQ2ZDdjIiwibm9uY2UiOiJmNWNjYWQ1Zi0yMzdkLTQzNTYtYmNiNi0yM2M2YmZmMTBhNDUiLCJtYXhfYWdlIjoiODY0MDAwMCIsImlhdCI6MTU3NDk0MzcxNCwicmVkaXJlY3RfdXJpIjoiaHR0cDovL2xvY2FsaG9zdDo4NTg1L3JlZGlyZWN0TWUiLCJjbGFpbXMiOnsidXNlcmluZm8iOnsib3BlbmJhbmtpbmdfaW50ZW50X2lkIjp7InZhbHVlIjoidXJuOmFpYjphcGlnYXRld2F5Om9wZW4tYmFua2luZzphaXNwOmFjY291bnQtYWNjZXNzLWNvbnNlbnRzOnYzLjE6MTE3ZDU0NDMtNGVkNS00Njg5LWE5MjMtNjAxMDk4ZmYyNzQ0IiwiZXNzZW50aWFsIjp0cnVlfX0sImlkX3Rva2VuIjp7Im9wZW5iYW5raW5nX2ludGVudF9pZCI6eyJ2YWx1ZSI6InVybjphaWI6YXBpZ2F0ZXdheTpvcGVuLWJhbmtpbmc6YWlzcDphY2NvdW50LWFjY2Vzcy1jb25zZW50czp2My4xOjExN2Q1NDQzLTRlZDUtNDY4OS1hOTIzLTYwMTA5OGZmMjc0NCIsImVzc2VudGlhbCI6dHJ1ZX0sImFjciI6eyJlc3NlbnRpYWwiOnRydWUsInZhbHVlcyI6WyJ1cm46YWliOmFwaWdhdGV3YXk6b3Blbi1iYW5raW5nOmFpc3A6YWNjb3VudC1hY2Nlc3MtY29uc2VudHM6djMuMToxMTdkNTQ0My00ZWQ1LTQ2ODktYTkyMy02MDEwOThmZjI3NDQiXX19fSwiZXhwIjoxNTc0OTQ3MzE0fQ.FsCGyN3O5GQ2DtjIHDQgNrqi2av3rzu2LJsWj5ZhYE5bDvGvyacn89kIeCZToDXQKGX_4LvTRWcto4jXISI8voyyBL9Prb4TDynlgXpOJ1PIV5Xs9NbkWNnJRuLWgShzw_OlNruZlD3AR61KbN9SvxLTin3ds_0DVwZX1FS0PgBz33LqWffhhKal0V4FUTqD1FUKMP6Q-8WqeyHOhCMqUqVM3S32tfin7RMODzZeS75_FZxgr199i8BVllgGBMx4nnvVwEL1P3SAa49H5OF4cvbsGvoj5TUXua31c4z1ximxCkhwx2-JBoQHtQ91fGm3hknDFxfg8mNEBJ6cRVZhWQ%2526state%253D9e726748-c119-46dd-84dc-241cc39d6d7c%2526nonce%253Df5ccad5f-237d-4356-bcb6-23c6bff10a45";
//    System.out.println(consentChannelController.extractQueryString(query, "request"));
      mockMvc.perform(post("/consent/auth?response_type=code%20id_token&scope=openid%20accounts&state=3322efb6-90b8-4c56-a37a-ce8581ff5d17&nonce=f960a830cf29471ba1d7d188a673708e&client_id=CFYCWL6wieDTIbACt3s6leB3GnC5Sw5u&redirect_uri=https://openbanking.directid.co/local/redirect&request=eyJhbGciOiJSUzI1NiIsImtpZCI6InNqN1FiWmdlV1htdVd5aDlEeFJpc25OSVpmayIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1cm46YWliOmFwaWdhdGV3YXk6b3Blbi1iYW5raW5nOmFpc3A6YWNjb3VudC1hY2Nlc3MtY29uc2VudHM6djMuMToxMjYwYzUzYi01OGE1LTQ5OGUtYjI0Zi1iOGZmMDgwODZmYzkiLCJhdWQiOiJodHRwczovL2FwaXMuYWliZ2IuY28udWsvIiwiaXNzIjoiQ0ZZQ1dMNndpZURUSWJBQ3QzczZsZUIzR25DNVN3NXUiLCJpYXQiOjE1NzA0NjQwMTQsImV4cCI6MTU3MDQ2NzYxNCwiYWNyX3ZhbHVlcyI6InVybjpvcGVuYmFua2luZzpwc2QyOnNjYSB1cm46b3BlbmJhbmtpbmc6cHNkMjpjYSIsImNsYWltcyI6eyJ1c2VyaW5mbyI6eyJvcGVuYmFua2luZ19pbnRlbnRfaWQiOnsidmFsdWUiOiJ1cm46YWliOmFwaWdhdGV3YXk6b3Blbi1iYW5raW5nOmFpc3A6YWNjb3VudC1hY2Nlc3MtY29uc2VudHM6djMuMToxMjYwYzUzYi01OGE1LTQ5OGUtYjI0Zi1iOGZmMDgwODZmYzkiLCJlc3NlbnRpYWwiOnRydWV9fSwiaWRfdG9rZW4iOnsib3BlbmJhbmtpbmdfaW50ZW50X2lkIjp7InZhbHVlIjoidXJuOmFpYjphcGlnYXRld2F5Om9wZW4tYmFua2luZzphaXNwOmFjY291bnQtYWNjZXNzLWNvbnNlbnRzOnYzLjE6MTI2MGM1M2ItNThhNS00OThlLWIyNGYtYjhmZjA4MDg2ZmM5IiwiZXNzZW50aWFsIjp0cnVlfSwiYWNyIjp7ImVzc2VudGlhbCI6dHJ1ZX19fSwicmVzcG9uc2VfdHlwZSI6ImNvZGUgaWRfdG9rZW4iLCJzY29wZSI6Im9wZW5pZCBhY2NvdW50cyIsInN0YXRlIjoiMzMyMmVmYjYtOTBiOC00YzU2LWEzN2EtY2U4NTgxZmY1ZDE3Iiwibm9uY2UiOiJmOTYwYTgzMGNmMjk0NzFiYTFkN2QxODhhNjczNzA4ZSIsImNsaWVudF9pZCI6IkNGWUNXTDZ3aWVEVEliQUN0M3M2bGVCM0duQzVTdzV1IiwicmVkaXJlY3RfdXJpIjoiaHR0cHM6Ly9vcGVuYmFua2luZy5kaXJlY3RpZC5jby9sb2NhbC9yZWRpcmVjdCJ9.b1g4SZhZ8678SAL7V7C0Mzsykz-IDYijustALNfLinaOsVxWdYDbkeFy4R-uKx0OXaCDe_I_jac89EMlvGaOwXsawD18Q3O0aIh515H3p1WXb5Atm4bkDXlbRvE0Kt5qVd5FAA6DFRijNg8jVMtCLX2AHm4exGwjg83HMc1BRvfu6_xP_q_v4tynOeQAyvCb-wUeWrCyjcxldRlqqyBZ6JxdYACi0DBTQe-Fiby2r44_ZK4k63nbnunkUr7WcQdCjtku3QkpiHagtEftO5gjeN50cGdv40EgZ5N1OuFTKYADNkVrNB7M7sbWeYBn5-LrU4LT_hqOG7UJ7MB-9xNuXA")
              .contentType(MediaType.APPLICATION_OCTET_STREAM_VALUE)
              .accept(MediaType.APPLICATION_JSON_UTF8_VALUE))
              .andExpect(status().is2xxSuccessful());
  }
}